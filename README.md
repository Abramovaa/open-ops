Открытая оптимизирующая распараллеливающая система (Open OPS)
=========================

Введение
--------
Открытая оптимизирующая распараллеливающая система (OpenOPS)
строится на базе ОРС – Оптимизирующей распараллеливающей системы
(www.ops.rsu.ru). Система OpenOPS создается постепенным открытием
кода ОРС с возможными модификациями.

Оптимизирующая распараллеливающая система (ОРС) может быть
полезна для создания оптимизирующих распараллеливающих
компиляторов на новые параллельные вычислительные архитектуры. На
основе ОРС разработан, например, экспериментальный веб-авто-
распараллеливатель на вычислительный кластер и на графическую карту
http://ops.opsgroup.ru/. Ведутся работы по отображению программ языка Си
на процессор в ПЛИС-ускорителем.

ОРС отличается от семейств компиляторов GCC и LLVM более высоким
уровнем внутреннего представления (ВП). Это, с одной стороны, сужает
класс входных языков, но, с другой стороны, расширяет класс целевых
архитектур. Кроме того, высокоуровневое ВП более удобно для создания
диалогового режима оптимизации программ в компиляторе. На данный
момент на входе ОРС язык С99 с парсером Clang и фортран. В первой
версии OpenOPS – только Си с парсером Clang.

Кроме того, что в ВП ОРС отображаются программы парсером Clang,
существует и обратное отображение – конвертер из ВП ОРС в Clang. Это
может позволить использовать ОРС в компиляторе Clang.

Первая версия OpenOPS будет содержать только ВП ОРС и функции,
позволяющие принимать в ВП ОРС программы языка Си парсера Clang.
Этого, в принципе, уже достаточно для разработки генератора кода из ВП
ОРС на какую-нибудь вычислительную архитектуру.

В последующих версиях OpenOPS предполагается открыть код графа
информационных связей, который необходим для анализа
информационных зависимостей, способных препятствовать
распараллеливанию.

Далее предполагается открывать код преобразований программ во
внутреннем представлении ОРС. Эти преобразования смогут
преобразовывать программные циклы, не допускающие непосредственного
распараллеливания (векторизации, конвейеризации) к виду, допускающему
оптимизацию.

Как собрать Open OPS под Linux
-------------------------
### Что понадобится

Предварительно необходимо (в скобках указаны названия пакетов для Ubuntu/Debian):

1. Установить стандартные программы для сборки приложений: g++, make и т.д. В Ubuntu/Debian для этого достаточно установить пакет build-essential.
2. Установить архиватор 7z (пакет для Ubuntu/Debian: p7zip-full).
3. Установить библиотеку Qt версии не ниже 5.0.0. Для Ubuntu >= 13.04 достаточно установить пакеты qt5-default, libqt5svg5-dev. Для остальных систем Qt можно установить с помощью официального инсталлятора: http://qt-project.org/downloads 
4. Установить утилиту wget.

### Сборка зависимостей

Проект ОРС зависит от нескольких внешних библиотек. Их необходимо заранее собрать из исходных текстов. Далее приводятся инструкции по сборке и установке. Для примера предполагается, что исходные тексты располагаются в директории @~/Src@ , а установка готовых библиотек производится в директорию @~/Lib/<имябиблиотеки>@, однако, можно использовать любые другие директории. После установки каждой библиотеки, соответствующие директории с исходными кодами и файлами сборки можно удалить.

### Сборка LLVM и Clang 3.3

Сборка осуществляется следующими командами:
<pre>
cd ~/Src
wget http://llvm.org/releases/3.3/llvm-3.3.src.tar.gz      # скачать LLVM 3.3
wget http://llvm.org/releases/3.3/cfe-3.3.src.tar.gz       # скачать Clang 3.3
tar -xvf llvm-3.3.src.tar.gz                               # распаковать LLVM
tar -xvf cfe-3.3.src.tar.gz                                # распаковать Clang
mv -T cfe-3.3.src llvm-3.3.src/tools/clang                 # переместить clang внутрь LLVM
mkdir llvm-3.3.build                                       # создать каталог сборки
cd llvm-3.3.build
cmake \
  -D CMAKE_BUILD_TYPE=Debug                               `: отладочная конфигурация, можно использовать Release или RelWithDebInfo` \
  -D LLVM_REQUIRES_RTTI=1                                 `: включить информацию о типах` \
  -D LLVM_TARGETS_TO_BUILD="X86;Sparc;ARM"                `: целевые платформы - произвольно` \
  -D BUILD_SHARED_LIBS=1                                  `: сборка динамических библиотек` \
  -D LLVM_INCLUDE_EXAMPLES=0 \
  -D LLVM_INCLUDE_TESTS=0 \
  -D CMAKE_INSTALL_PREFIX=~/Lib/llvm-3.3.install \        `: путь к директории для установки` \
  ../llvm-3.3.src
make                                                       # запуск сборки
make install                                               # установка библиотеки
</pre>

### Сборка OpenOPS

Сборка ОРС осуществляется с помощью системы cmake. Сборка управляется следующими переменными (обязательные отмечены жирным):
* *OPS_LLVM_DIR* - директория, куда установлена LLVM
* OPS_PARALLEL_BUILD - флаг распараллеливания сборки. По умолчанию включен.
* BUILD_SHARED_LIBS - флаг управляющий сборкой динамических библиотек. По умолчанию отключен. Позволяет уменьшить время сборки и размер результирующих исполнимых файлов.

Сборка осуществляется следующими командами:
#### создать каталог сборки
<pre>mkdir ops-build && cd ops-build</pre>
#### Запустить cmake для генерации Makefile-ов
<pre>cmake \
  -D CMAKE_BUILD_TYPE=Debug              `: отладочная конфигурация`\
  -D OPS_LLVM_DIR=~/Lib/llvm-3.3.install `: путь к LLVM`\
  -D BUILD_SHARED_LIBS=1                 `: использовать динамические библиотеки`\
  ../ops</pre>
#### Запустить сборку
<pre>make</pre>
